<!doctype html><html lang=zh-cn><head prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#"><meta charset=utf-8><meta name=generator content="Hugo 0.101.0"><meta name=theme-color content="#16171d"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=format-detection content="telephone=no, date=no, address=no, email=no"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><title>Spring笔记-黑马版 | leenadz</title><link rel=stylesheet href=/css/meme.min.css><script src=/js/meme.min.js></script>
<script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
<link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400;0,500;0,700;1,400;1,700&family=Noto+Serif+SC:wght@400;500;700&family=Source+Code+Pro:ital,wght@0,400;0,700;1,400;1,700&display=swap" media=print onload='this.media="all"'><noscript><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400;0,500;0,700;1,400;1,700&family=Noto+Serif+SC:wght@400;500;700&family=Source+Code+Pro:ital,wght@0,400;0,700;1,400;1,700&display=swap"></noscript><meta name=author content="zdaneel"><meta name=description content="补充了黑马视频版本的笔记，黑马版相比之下更加深入，对原理的讲解也要清晰很多。 一、概述……
    
    "><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><link rel=mask-icon href=/icons/safari-pinned-tab.svg color=#2a6df4><link rel=apple-touch-icon sizes=180x180 href=/icons/apple-touch-icon.png><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-title content="leenadz"><meta name=apple-mobile-web-app-status-bar-style content="black-translucent"><meta name=mobile-web-app-capable content="yes"><meta name=application-name content="leenadz"><meta name=msapplication-starturl content="../../"><meta name=msapplication-TileColor content="#fff"><meta name=msapplication-TileImage content="../../icons/mstile-150x150.png"><link rel=manifest href=/manifest.json><link rel=canonical href=https://zdaneel.github.io/tech/spring%E7%AC%94%E8%AE%B0-%E9%BB%91%E9%A9%AC%E7%89%88/><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","datePublished":"2022-05-03T15:50:36+08:00","dateModified":"2022-08-06T04:06:37+00:00","url":"https://zdaneel.github.io/tech/spring%E7%AC%94%E8%AE%B0-%E9%BB%91%E9%A9%AC%E7%89%88/","headline":"Spring笔记-黑马版","description":"补充了黑马视频版本的笔记，黑马版相比之下更加深入，对原理的讲解也要清晰很多。 一、概述……\n    \n    ","inLanguage":"zh-CN","articleSection":"tech","wordCount":7752,"image":["https://cdn.jsdelivr.net/gh/ZDaneel/cloudimg@main/img/202207111601133.png","https://cdn.jsdelivr.net/gh/ZDaneel/cloudimg@main/img/202207111618069.png","https://cdn.jsdelivr.net/gh/ZDaneel/cloudimg@main/img/202207121845761.png","https://cdn.jsdelivr.net/gh/ZDaneel/cloudimg@main/img/202207141344537.png","https://cdn.jsdelivr.net/gh/ZDaneel/cloudimg@main/img/202207151636919.png"],"author":{"@type":"Person","description":"Personal is political.","email":"z1436910962@gmail.com","image":"https://zdaneel.github.io/icons/apple-touch-icon.png","url":"https://zd-dz.cc","name":"zdaneel"},"license":"在保留本文作者及本文链接的前提下，非商业用途随意转载分享。","publisher":{"@type":"Organization","name":"leenadz","logo":{"@type":"ImageObject","url":"https://zdaneel.github.io/icons/apple-touch-icon.png"},"url":"https://zdaneel.github.io/"},"mainEntityOfPage":{"@type":"WebSite","@id":"https://zdaneel.github.io/"}}</script><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@ZDaneelZ"><meta name=twitter:creator content="@ZDaneelZ"><meta property="og:title" content="Spring笔记-黑马版"><meta property="og:description" content="补充了黑马视频版本的笔记，黑马版相比之下更加深入，对原理的讲解也要清晰很多。 一、概述……
    
    "><meta property="og:url" content="https://zdaneel.github.io/tech/spring%E7%AC%94%E8%AE%B0-%E9%BB%91%E9%A9%AC%E7%89%88/"><meta property="og:site_name" content="leenadz"><meta property="og:locale" content="zh"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/ZDaneel/cloudimg@main/img/202207111601133.png"><meta property="og:type" content="article"><meta property="article:published_time" content="2022-05-03T15:50:36+08:00"><meta property="article:modified_time" content="2022-08-06T04:06:37+00:00"><meta property="article:section" content="tech"></head><body><div class=container><header class=header data-scroll-header><div class=header-wrapper><div class="header-inner single"><div class=site-brand><a href=/ class=brand>leenadz</a></div><nav class=nav><ul class=menu id=menu><li class=menu-item><a href=/posts/><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon posts"><path d="M32 448c0 17.7 14.3 32 32 32h384c17.7.0 32-14.3 32-32V160H32v288zm160-212c0-6.6 5.4-12 12-12h104c6.6.0 12 5.4 12 12v8c0 6.6-5.4 12-12 12H204c-6.6.0-12-5.4-12-12v-8zM480 32H32C14.3 32 0 46.3.0 64v48c0 8.8 7.2 16 16 16h480c8.8.0 16-7.2 16-16V64c0-17.7-14.3-32-32-32z"/></svg><span class=menu-item-name>文章</span></a></li><li class=menu-item><a href=/tech/><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon tech"><path d="M512 256c0 141.2-114.7 256-256 256C114.8 512 0 397.3.0 256S114.7.0 256 0s256 114.7 256 256zm-32 0c0-123.2-100.3-224-224-224C132.5 32 32 132.5 32 256s100.5 224 224 224 224-100.5 224-224zM160.9 124.6l86.9 37.1-37.1 86.9-86.9-37.1 37.1-86.9zm110 169.1 46.6 94h-14.6l-50-1e2-48.9 1e2h-14l51.1-106.9-22.3-9.4 6-14 68.6 29.1-6 14.3-16.5-7.1zm-11.8-116.3 68.6 29.4-29.4 68.3L230 246l29.1-68.6zm80.3 42.9 54.6 23.1-23.4 54.3-54.3-23.1 23.1-54.3z"/></svg><span class=menu-item-name>技术</span></a></li><li class=menu-item><a href=/femi/><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon femi"><path d="M301.1 212c4.4 4.4 4.4 11.9.0 16.3l-9.7 9.7c-4.4 4.7-11.9 4.7-16.6.0l-10.5-10.5c-4.4-4.7-4.4-11.9.0-16.6l9.7-9.7c4.4-4.4 11.9-4.4 16.6.0l10.5 10.8zm-30.2-19.7c3-3 3-7.8.0-10.5-2.8-3-7.5-3-10.5.0-2.8 2.8-2.8 7.5.0 10.5 3.1 2.8 7.8 2.8 10.5.0zm-26 5.3c-3 2.8-3 7.5.0 10.2 2.8 3 7.5 3 10.5.0 2.8-2.8 2.8-7.5.0-10.2-3-3-7.7-3-10.5.0zm72.5-13.3c-19.9-14.4-33.8-43.2-11.9-68.1 21.6-24.9 40.7-17.2 59.8.8 11.9 11.3 29.3 24.9 17.2 48.2-12.5 23.5-45.1 33.2-65.1 19.1zm47.7-44.5c-8.9-10-23.3 6.9-15.5 16.1 7.4 9 32.1 2.4 15.5-16.1zM504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-66.2 42.6c2.5-16.1-20.2-16.6-25.2-25.7-13.6-24.1-27.7-36.8-54.5-30.4 11.6-8 23.5-6.1 23.5-6.1.3-6.4.0-13-9.4-24.9 3.9-12.5.3-22.4.3-22.4 15.5-8.6 26.8-24.4 29.1-43.2 3.6-31-18.8-59.2-49.8-62.8-22.1-2.5-43.7 7.7-54.3 25.7-23.2 40.1 1.4 70.9 22.4 81.4-14.4-1.4-34.3-11.9-40.1-34.3-6.6-25.7 2.8-49.8 8.9-61.4.0.0-4.4-5.8-8-8.9.0.0-13.8.0-24.6 5.3 11.9-15.2 25.2-14.4 25.2-14.4.0-6.4-.6-14.9-3.6-21.6-5.4-11-23.8-12.9-31.7 2.8.1-.2.3-.4.4-.5-5 11.9-1.1 55.9 16.9 87.2-2.5 1.4-9.1 6.1-13 10-21.6 9.7-56.2 60.3-56.2 60.3-28.2 10.8-77.2 50.9-70.6 79.7.3 3 1.4 5.5 3 7.5-2.8 2.2-5.5 5-8.3 8.3-11.9 13.8-5.3 35.2 17.7 24.4 15.8-7.2 29.6-20.2 36.3-30.4.0.0-5.5-5-16.3-4.4 27.7-6.6 34.3-9.4 46.2-9.1 8 3.9 8-34.3 8-34.3.0-14.7-2.2-31-11.1-41.5 12.5 12.2 29.1 32.7 28 60.6-.8 18.3-15.2 23-15.2 23-9.1 16.6-43.2 65.9-30.4 106 0 0-9.7-14.9-10.2-22.1-17.4 19.4-46.5 52.3-24.6 64.5 26.6 14.7 108.8-88.6 126.2-142.3 34.6-20.8 55.4-47.3 63.9-65 22 43.5 95.3 94.5 101.1 59z"/></svg><span class=menu-item-name>女权</span></a></li><li class=menu-item><a href=/about/><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" class="icon about"><path d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 96c48.6.0 88 39.4 88 88s-39.4 88-88 88-88-39.4-88-88 39.4-88 88-88zm0 344c-58.7.0-111.3-26.6-146.5-68.2 18.8-35.4 55.6-59.8 98.5-59.8 2.4.0 4.8.4 7.1 1.1 13 4.2 26.6 6.9 40.9 6.9s28-2.7 40.9-6.9c2.3-.7 4.7-1.1 7.1-1.1 42.9.0 79.7 24.4 98.5 59.8C359.3 421.4 306.7 448 248 448z"/></svg><span class=menu-item-name>关于</span></a></li><li class=menu-item><a id=theme-switcher href=#><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon theme-icon-light"><path d="M193.2 104.5 242 7a18 18 0 0128 0l48.8 97.5L422.2 70A18 18 0 01442 89.8l-34.5 103.4L505 242a18 18 0 010 28l-97.5 48.8L442 422.2A18 18 0 01422.2 442l-103.4-34.5L270 505a18 18 0 01-28 0l-48.8-97.5L89.8 442A18 18 0 0170 422.2l34.5-103.4-97.5-48.8a18 18 0 010-28l97.5-48.8L70 89.8A18 18 0 0189.8 70zM256 128a128 128 0 10.01.0M256 160a96 96 0 10.01.0"/></svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon theme-icon-dark"><path d="M27 412A256 256 0 10181 5a11.5 11.5.0 00-5 20A201.5 201.5.0 0142 399a11.5 11.5.0 00-15 13"/></svg></a></li></ul></nav></div></div><input type=checkbox id=nav-toggle aria-hidden=true>
<label for=nav-toggle class=nav-toggle></label>
<label for=nav-toggle class=nav-curtain></label></header><main class="main single" id=main><div class=main-inner><article class="content post" data-align=justify data-type=tech><h1 class=post-title>Spring笔记-黑马版<h5 id=h5 style=font-size:1rem;text-align:center>共
7800
字<br>阅读约
16
分钟</h5></h1><nav class=contents><h2 id=contents class=contents-title>目录</h2><ol class=toc><li><a id=contents:一概述 href=#一概述>一、概述</a></li><li><a id=contents:二耦合解耦 href=#二耦合解耦>二、耦合解耦</a><ol><li><a id=contents:耦合 href=#耦合>耦合</a></li><li><a id=contents:解耦 href=#解耦>解耦</a></li></ol></li><li><a id=contents:三工厂模式 href=#三工厂模式>三、工厂模式</a><ol><li><a id=contents:实现步骤 href=#实现步骤>实现步骤</a><ol><li><a id=contents:1-配置文件 href=#1-配置文件>1. 配置文件</a></li><li><a id=contents:2-bean工厂 href=#2-bean工厂>2. Bean工厂</a></li><li><a id=contents:3-调用bean工厂 href=#3-调用bean工厂>3. 调用Bean工厂</a></li></ol></li><li><a id=contents:存在问题 href=#存在问题>存在问题</a><ol><li><a id=contents:1-多例vs单例 href=#1-多例vs单例>1. 多例vs单例</a></li><li><a id=contents:2-改进后 href=#2-改进后>2. 改进后</a></li></ol></li></ol></li><li><a id=contents:四ioc href=#四ioc>四、IoC</a></li><li><a id=contents:五创建bean方式 href=#五创建bean方式>五、创建bean方式</a><ol><li><a id=contents:1-默认构造函数 href=#1-默认构造函数>1. 默认构造函数</a></li><li><a id=contents:2-普通工厂中方法 href=#2-普通工厂中方法>2. 普通工厂中方法</a></li><li><a id=contents:3-使用静态方法 href=#3-使用静态方法>3. 使用静态方法</a></li></ol></li><li><a id=contents:六作用范围 href=#六作用范围>六、作用范围</a></li><li><a id=contents:七生命周期 href=#七生命周期>七、生命周期</a><ol><li><a id=contents:1-单例 href=#1-单例>1. 单例</a></li><li><a id=contents:2-多例 href=#2-多例>2. 多例</a></li></ol></li><li><a id=contents:八注入 href=#八注入>八、注入</a><ol><li><a id=contents:1-依赖注入 href=#1-依赖注入>1. 依赖注入</a><ol><li><a id=contents:11-构造函数注入 href=#11-构造函数注入>1.1 构造函数注入</a></li><li><a id=contents:12-set方法注入 href=#12-set方法注入>1.2 set方法注入</a></li><li><a id=contents:13-注解提供 href=#13-注解提供>1.3 注解提供</a></li></ol></li></ol></li><li><a id=contents:九代理 href=#九代理>九、代理</a><ol><li><a id=contents:基于接口的代理jdk href=#基于接口的代理jdk>基于接口的代理（JDK）</a><ol><li><a id=contents:1-引入 href=#1-引入>1. 引入</a></li><li><a id=contents:2-直接修改 href=#2-直接修改>2. 直接修改</a></li><li><a id=contents:3-静态代理 href=#3-静态代理>3. 静态代理</a></li><li><a id=contents:4-动态代理 href=#4-动态代理>4. 动态代理</a></li></ol></li><li><a id=contents:基于子类的代理cglib href=#基于子类的代理cglib>基于子类的代理（cglib）</a></li></ol></li><li><a id=contents:十aop href=#十aop>十、AOP</a><ol><li><a id=contents:1-aop href=#1-aop>1. AOP</a></li><li><a id=contents:2-spring中的aop href=#2-spring中的aop>2. Spring中的AOP</a><ol><li><a id=contents:xml文件头 href=#xml文件头>XMl文件头</a></li></ol></li><li><a id=contents:3常用通知类型 href=#3常用通知类型>3.常用通知类型</a><ol><li><a id=contents:配置信息 href=#配置信息>配置信息</a></li><li><a id=contents:正常运行 href=#正常运行>正常运行</a></li><li><a id=contents:出现异常 href=#出现异常>出现异常</a></li></ol></li><li><a id=contents:4-切入点表达式 href=#4-切入点表达式>4. 切入点表达式</a></li><li><a id=contents:5-环绕通知 href=#5-环绕通知>5. 环绕通知</a></li><li><a id=contents:6-基于注解的aop href=#6-基于注解的aop>6. 基于注解的AOP</a></li></ol></li></ol></nav><div class=post-body><p>补充了黑马视频版本的笔记，黑马版相比之下更加深入，对原理的讲解也要清晰很多。</p><h2 id=一概述><a href=#一概述 class=anchor-link>#</a><a href=#contents:一概述 class=headings>一、概述</a></h2><p>IoC和AOP为内核，full-stack轻量级开源框架</p><p>体系结构</p><p>核心容器Core Container</p><h2 id=二耦合解耦><a href=#二耦合解耦 class=anchor-link>#</a><a href=#contents:二耦合解耦 class=headings>二、耦合解耦</a></h2><p>操作数据库jdbc</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>App</span> 
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span> <span class=n>String</span><span class=o>[]</span> <span class=n>args</span> <span class=o>)</span> <span class=kd>throws</span> <span class=n>SQLException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>//1. 注册驱动
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>DriverManager</span><span class=o>.</span><span class=na>registerDriver</span><span class=o>(</span><span class=k>new</span> <span class=n>com</span><span class=o>.</span><span class=na>mysql</span><span class=o>.</span><span class=na>cj</span><span class=o>.</span><span class=na>jdbc</span><span class=o>.</span><span class=na>Driver</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=c1>//2. 获取连接
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>Connection</span> <span class=n>conn</span> <span class=o>=</span> <span class=n>DriverManager</span><span class=o>.</span><span class=na>getConnection</span><span class=o>(</span><span class=s>&#34;jdbc:mysql://localhost:3306/mybatis&#34;</span><span class=o>,</span> <span class=s>&#34;root&#34;</span><span class=o>,</span> <span class=s>&#34;123456&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>//3. 获取操作数据库的预处理对象
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>PreparedStatement</span> <span class=n>pstm</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=na>prepareStatement</span><span class=o>(</span><span class=s>&#34;select * from user&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>//4. 执行SQL，得到结果集
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>ResultSet</span> <span class=n>rs</span> <span class=o>=</span> <span class=n>pstm</span><span class=o>.</span><span class=na>executeQuery</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=c1>//5. 遍历结果集
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>while</span> <span class=o>(</span><span class=n>rs</span><span class=o>.</span><span class=na>next</span><span class=o>()){</span>
</span></span><span class=line><span class=cl>            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>rs</span><span class=o>.</span><span class=na>getString</span><span class=o>(</span><span class=s>&#34;name&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=c1>//6. 释放资源
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>rs</span><span class=o>.</span><span class=na>close</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>pstm</span><span class=o>.</span><span class=na>close</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>conn</span><span class=o>.</span><span class=na>close</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div></div><h3 id=耦合><a href=#耦合 class=anchor-link>#</a><a href=#contents:耦合 class=headings>耦合</a></h3><p>程序间的依赖关系</p><ul><li>类之间的依赖</li><li>方法间的依赖</li></ul><h3 id=解耦><a href=#解耦 class=anchor-link>#</a><a href=#contents:解耦 class=headings>解耦</a></h3><p>降低程序间的依赖关系</p><p>new com.mysql.cj.jdbc.Driver()的独立性很差，在编译期间就会产生依赖</p><p>实际开发中需要：编译期不依赖，运行时才依赖</p><ul><li>思路一：使用反射来创建对象，避免使用关键字</li></ul><p>改成</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Class</span><span class=o>.</span><span class=na>forName</span><span class=o>(</span><span class=s>&#34;com.mysql.cj.jdbc.Driver&#34;</span><span class=o>);</span>
</span></span></code></pre></td></tr></table></div></div></div><p>运行时才发生错误</p><ul><li>思路二：读取配置文件来获取要创建对象的全限定类名</li></ul><h2 id=三工厂模式><a href=#三工厂模式 class=anchor-link>#</a><a href=#contents:三工厂模式 class=headings>三、工厂模式</a></h2><p>创建bean对象的工厂BeanFactory</p><p>Bean：可重用组件</p><p>JavaBean != 实体类，JavaBean范围大很多——用Java编写的可重用组件</p><ul><li>配置文件配置<ul><li>唯一标识=全限定类名（key=value）（限定类名，就是类名全称，带包路径的用点隔开</li><li>类型为xml或者properties（或yml）</li></ul></li><li>反射读取配置文件内容创建对象</li></ul><h3 id=实现步骤><a href=#实现步骤 class=anchor-link>#</a><a href=#contents:实现步骤 class=headings>实现步骤</a></h3><h4 id=1-配置文件><a href=#1-配置文件 class=anchor-link>#</a><a href=#contents:1-配置文件 class=headings>1. 配置文件</a></h4><p>bean.properties</p><p>配置中的为实现类</p><pre tabindex=0><code class=language-properties data-lang=properties>accountDao=org.example.dao.impl.AccountDaoImpl
accountService=org.example.service.impl.AccountServiceImpl
</code></pre><h4 id=2-bean工厂><a href=#2-bean工厂 class=anchor-link>#</a><a href=#contents:2-bean工厂 class=headings>2. Bean工厂</a></h4><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * Bean工厂
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>BeanFactory</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>static</span> <span class=n>Properties</span> <span class=n>props</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm>      初始化prop
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=kd>static</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>//实例化对象
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>props</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Properties</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=c1>//读取配置文件
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>InputStream</span> <span class=n>in</span> <span class=o>=</span> <span class=n>BeanFactory</span><span class=o>.</span><span class=na>class</span><span class=o>.</span><span class=na>getClassLoader</span><span class=o>().</span><span class=na>getResourceAsStream</span><span class=o>(</span><span class=s>&#34;bean.properties&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>props</span><span class=o>.</span><span class=na>load</span><span class=o>(</span><span class=n>in</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>Exception</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;初始化配置失败&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>e</span><span class=o>.</span><span class=na>printStackTrace</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 反射获取实例
</span></span></span><span class=line><span class=cl><span class=cm>     * @param beanName bean名字
</span></span></span><span class=line><span class=cl><span class=cm>     * @return 实体类
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>Object</span> <span class=nf>getBean</span><span class=o>(</span><span class=n>String</span> <span class=n>beanName</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Object</span> <span class=n>bean</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>          	<span class=c1>//读取bean的全限定类名
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>String</span> <span class=n>beanPath</span> <span class=o>=</span> <span class=n>props</span><span class=o>.</span><span class=na>getProperty</span><span class=o>(</span><span class=n>beanName</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>bean</span> <span class=o>=</span> <span class=n>Class</span><span class=o>.</span><span class=na>forName</span><span class=o>(</span><span class=n>beanPath</span><span class=o>).</span><span class=na>getDeclaredConstructor</span><span class=o>().</span><span class=na>newInstance</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>Exception</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;获取实例失败&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>e</span><span class=o>.</span><span class=na>printStackTrace</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>bean</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div></div><h4 id=3-调用bean工厂><a href=#3-调用bean工厂 class=anchor-link>#</a><a href=#contents:3-调用bean工厂 class=headings>3. 调用Bean工厂</a></h4><p>注释的为最开始的高耦合写法</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>//private final IAccountDao accountDao = new AccountDaoImpl();
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>private</span> <span class=kd>final</span> <span class=n>IAccountDao</span> <span class=n>accountDao</span> <span class=o>=</span> <span class=o>(</span><span class=n>IAccountDao</span><span class=o>)</span> <span class=n>BeanFactory</span><span class=o>.</span><span class=na>getBean</span><span class=o>(</span><span class=s>&#34;accountDao&#34;</span><span class=o>);</span>
</span></span></code></pre></td></tr></table></div></div></div><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>//IAccountService as = new AccountServiceImpl();
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>IAccountService</span> <span class=n>as</span> <span class=o>=</span> <span class=o>(</span><span class=n>IAccountService</span><span class=o>)</span> <span class=n>BeanFactory</span><span class=o>.</span><span class=na>getBean</span><span class=o>(</span><span class=s>&#34;accountService&#34;</span><span class=o>);</span>
</span></span></code></pre></td></tr></table></div></div></div><h3 id=存在问题><a href=#存在问题 class=anchor-link>#</a><a href=#contents:存在问题 class=headings>存在问题</a></h3><p>使用循环创建，目前是多例</p><p><img src=https://cdn.jsdelivr.net/gh/ZDaneel/cloudimg@main/img/202207111601133.png alt="截屏2022-07-11 16.01.08"></p><h4 id=1-多例vs单例><a href=#1-多例vs单例 class=anchor-link>#</a><a href=#contents:1-多例vs单例 class=headings>1. 多例vs单例</a></h4><p>多例即每次都创建一个新的实例，成员每次都会初始化</p><p>单例即只被创建一次，类中成员只会初始化一次</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>bean</span> <span class=o>=</span> <span class=n>Class</span><span class=o>.</span><span class=na>forName</span><span class=o>(</span><span class=n>beanPath</span><span class=o>).</span><span class=na>getDeclaredConstructor</span><span class=o>().</span><span class=na>newInstance</span><span class=o>();</span>
</span></span></code></pre></td></tr></table></div></div></div><p>这句话表示每次都会用默认构造器创建，应该要存起来——>使用容器Map</p><h4 id=2-改进后><a href=#2-改进后 class=anchor-link>#</a><a href=#contents:2-改进后 class=headings>2. 改进后</a></h4><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * Bean工厂
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>BeanFactory</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>//定义一个配置对象
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>private</span> <span class=kd>static</span> <span class=n>Properties</span> <span class=n>props</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>//定义一个Map，用于存放创建的对象，称为容器
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>private</span> <span class=kd>static</span> <span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span><span class=n>Object</span><span class=o>&gt;</span> <span class=n>beans</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm>      初始化prop
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=kd>static</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>//实例化对象
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>props</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Properties</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=c1>//读取配置文件
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>InputStream</span> <span class=n>in</span> <span class=o>=</span> <span class=n>BeanFactory</span><span class=o>.</span><span class=na>class</span><span class=o>.</span><span class=na>getClassLoader</span><span class=o>().</span><span class=na>getResourceAsStream</span><span class=o>(</span><span class=s>&#34;bean.properties&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>props</span><span class=o>.</span><span class=na>load</span><span class=o>(</span><span class=n>in</span><span class=o>);</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>            <span class=c1>//实例化容器
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>beans</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashMap</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>            <span class=c1>//取配置文件的keys
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>Enumeration</span><span class=o>&lt;</span><span class=n>Object</span><span class=o>&gt;</span> <span class=n>keys</span> <span class=o>=</span> <span class=n>props</span><span class=o>.</span><span class=na>keys</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=c1>//遍历枚举
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>while</span> <span class=o>(</span><span class=n>keys</span><span class=o>.</span><span class=na>hasMoreElements</span><span class=o>())</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=c1>//取出key
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=n>String</span> <span class=n>key</span> <span class=o>=</span> <span class=n>keys</span><span class=o>.</span><span class=na>nextElement</span><span class=o>().</span><span class=na>toString</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                <span class=c1>//key获取value
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=n>String</span> <span class=n>beanPath</span> <span class=o>=</span> <span class=n>props</span><span class=o>.</span><span class=na>getProperty</span><span class=o>(</span><span class=n>key</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                <span class=c1>//反射创建对象
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=n>Object</span> <span class=n>value</span> <span class=o>=</span> <span class=n>Class</span><span class=o>.</span><span class=na>forName</span><span class=o>(</span><span class=n>beanPath</span><span class=o>).</span><span class=na>getDeclaredConstructor</span><span class=o>().</span><span class=na>newInstance</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                <span class=c1>//存入map容器
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=n>beans</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>key</span><span class=o>,</span> <span class=n>value</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>Exception</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;初始化配置失败&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>e</span><span class=o>.</span><span class=na>printStackTrace</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 反射获取实例
</span></span></span><span class=line><span class=cl><span class=cm>     * @param beanName bean名字
</span></span></span><span class=line><span class=cl><span class=cm>     * @return 实体类
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>Object</span> <span class=nf>getBean</span><span class=o>(</span><span class=n>String</span> <span class=n>beanName</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>beans</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>beanName</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div></div><p>之后打印：</p><p><img src=https://cdn.jsdelivr.net/gh/ZDaneel/cloudimg@main/img/202207111618069.png alt="截屏2022-07-11 16.18.08"></p><h2 id=四ioc><a href=#四ioc class=anchor-link>#</a><a href=#contents:四ioc class=headings>四、IoC</a></h2><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>//private final IAccountDao accountDao = new AccountDaoImpl();
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>private</span> <span class=kd>final</span> <span class=n>IAccountDao</span> <span class=n>accountDao</span> <span class=o>=</span> <span class=o>(</span><span class=n>IAccountDao</span><span class=o>)</span> <span class=n>BeanFactory</span><span class=o>.</span><span class=na>getBean</span><span class=o>(</span><span class=s>&#34;accountDao&#34;</span><span class=o>);</span>
</span></span></code></pre></td></tr></table></div></div></div><p>IoC（控制反转）：放弃了自己new的能力，将控制权交给工厂来处理</p><h2 id=五创建bean方式><a href=#五创建bean方式 class=anchor-link>#</a><a href=#contents:五创建bean方式 class=headings>五、创建bean方式</a></h2><h3 id=1-默认构造函数><a href=#1-默认构造函数 class=anchor-link>#</a><a href=#contents:1-默认构造函数 class=headings>1. 默认构造函数</a></h3><p>配置文件中使用bean标签，加上id和class属性，通过id找到class，反射创建class对应的文件</p><p>类中没有默认构造函数，则无法创建</p><h3 id=2-普通工厂中方法><a href=#2-普通工厂中方法 class=anchor-link>#</a><a href=#contents:2-普通工厂中方法 class=headings>2. 普通工厂中方法</a></h3><p>使用普通工厂中的方法创建对象</p><p>factory-bean指定普通工厂的bean，factory-method指定工厂里的方法</p><h3 id=3-使用静态方法><a href=#3-使用静态方法 class=anchor-link>#</a><a href=#contents:3-使用静态方法 class=headings>3. 使用静态方法</a></h3><p>class指定一个类，factory-method指定工厂里的静态方法</p><h2 id=六作用范围><a href=#六作用范围 class=anchor-link>#</a><a href=#contents:六作用范围 class=headings>六、作用范围</a></h2><ul><li>singleton：单例（默认值）</li><li>prototype：多例</li><li>request：作用于web应用的请求范围</li><li>session：作用域web应用的会话范围</li><li>global-session：作用于集群环境的会话范围（多个服务器共享一个session）</li></ul><h2 id=七生命周期><a href=#七生命周期 class=anchor-link>#</a><a href=#contents:七生命周期 class=headings>七、生命周期</a></h2><h3 id=1-单例><a href=#1-单例 class=anchor-link>#</a><a href=#contents:1-单例 class=headings>1. 单例</a></h3><p>和容器的生命周期相关</p><ul><li>出生：当容器创建时</li><li>活着：容器存在</li><li>死亡：容器销毁</li></ul><h3 id=2-多例><a href=#2-多例 class=anchor-link>#</a><a href=#contents:2-多例 class=headings>2. 多例</a></h3><ul><li>出生：当使用对象时创建</li><li>活着：使用过程中（Spring不知道何时要销毁</li><li>死亡：对象长时间不用，且没有对象引用时，GC回收</li></ul><h2 id=八注入><a href=#八注入 class=anchor-link>#</a><a href=#contents:八注入 class=headings>八、注入</a></h2><h3 id=1-依赖注入><a href=#1-依赖注入 class=anchor-link>#</a><a href=#contents:1-依赖注入 class=headings>1. 依赖注入</a></h3><p>Dependency Injection（DI）</p><h4 id=11-构造函数注入><a href=#11-构造函数注入 class=anchor-link>#</a><a href=#contents:11-构造函数注入 class=headings>1.1 构造函数注入</a></h4><p>使用的标签：constructor-arg</p><p>标签出现的位置，bean标签的内部</p><p>标签中的属性</p><ul><li>type：用于指定要注入的数据的数据类型，该数据类型也是构造函数中某个或某些参数的类型</li><li>index：用于指定要注入的数据给构造西数中指定素引位置的参数赋值。索引的位置是从e开始</li><li>name：用于指定給构造函数中指定名称的参数赋值</li></ul><p>以上三个用于指定给构造函数中哪个参数赋值</p><ul><li>value: 用于提供基本类型和String类型的数据</li><li>ref：用于指定其他的bean类型数据。指的就是在spring的Ioc核心容器中出现过的bean对象</li></ul><p>优势：</p><p>在获取bean对家时，注入数据是必须的操作，否则对象无法创建成功</p><p>弊端：</p><p>改变了bean对家的实例化方式，使我们在创建对家时，如果用不到这些数据，也必须提供</p><h4 id=12-set方法注入><a href=#12-set方法注入 class=anchor-link>#</a><a href=#contents:12-set方法注入 class=headings>1.2 set方法注入</a></h4><p>涉及的标签：property</p><p>出现的位置：bean标签的内部</p><p>标签的属性</p><ul><li>name：用于指定注入时所调用的set方法名称</li><li>value：用于提供基本类型和String类型的数据</li><li>ref：用于指定其他的bean类型数据。</li></ul><p>优势：</p><p>创建对象时没有明确的限制，可以直接使用默认构造函数</p><p>弊端：</p><p>如果有某个成员必须有值，则获取对象是有可能set方法没有执行</p><p>复杂类型具体参考狂神版</p><p>List结构注入的标签：list、array、set</p><p>Map结构注入的标签：map、props</p><h4 id=13-注解提供><a href=#13-注解提供 class=anchor-link>#</a><a href=#contents:13-注解提供 class=headings>1.3 注解提供</a></h4><p>开启注解使用aop的jar包</p><p>告知spring在创建容器时要扫描的包</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=c>&lt;!--略约束--&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;context:component-scan</span> <span class=na>base-backage=</span><span class=s>&#34;需要扫描包的全限定名&#34;</span><span class=nt>/&gt;</span>
</span></span></code></pre></td></tr></table></div></div></div><ul><li>创建对象</li></ul><p>@Component（@Repository、@Service、@Controller）</p><p>作用：将当前类对象存入spring容器</p><p>属性：value用于指定bean的id，默认为当前类名，首字母小写</p><ul><li>注入数据</li></ul><p>@Autowired：自动按照类型注入byType，使用@Qualifer指定名称（就是bean的id）</p><p>@Resource：自动按照名称注入byName</p><p><img src=https://cdn.jsdelivr.net/gh/ZDaneel/cloudimg@main/img/202207121845761.png alt=image-20220712164656460></p><p>@Value：用于注入基本类型和String类型的值</p><ul><li>改变作用范围</li></ul><p>@Scope：用户指定bean的作用范围</p><p>value来指定，默认还是单例</p><ul><li>生命周期（了解）</li></ul><p>@PreDestory：用于指定销毁方法</p><p>@PostConstruct：用于指定初始化方法</p><h2 id=九代理><a href=#九代理 class=anchor-link>#</a><a href=#contents:九代理 class=headings>九、代理</a></h2><p>生产+销售售后的分离，代理商负责销售售后，买家通过代理商购买或者售后产品</p><h3 id=基于接口的代理jdk><a href=#基于接口的代理jdk class=anchor-link>#</a><a href=#contents:基于接口的代理jdk class=headings>基于接口的代理（JDK）</a></h3><p><a href=https://www.zhihu.com/question/40536038/answer/658146278 target=_blank rel=noopener>如何理解动态代理? - bravo1988的回答 - 知乎</a></p><p>具体参考作者对应的小册文章</p><h4 id=1-引入><a href=#1-引入 class=anchor-link>#</a><a href=#contents:1-引入 class=headings>1. 引入</a></h4><p>场景：对一些方法统一添加操作，如事务、日志</p><p>解决方法：</p><h4 id=2-直接修改><a href=#2-直接修改 class=anchor-link>#</a><a href=#contents:2-直接修改 class=headings>2. 直接修改</a></h4><ul><li>不符合开闭原则。即好的程序应该对拓展开放，对修改关闭。</li><li>修改量大</li><li>代码重复</li><li>不利于维护</li></ul><h4 id=3-静态代理><a href=#3-静态代理 class=anchor-link>#</a><a href=#contents:3-静态代理 class=headings>3. 静态代理</a></h4><p>编写一个<strong>代理类</strong>，实现与目标对象相同的接口，在代理类中维护一个目标对象的引用</p><ul><li>抽取为接口</li></ul><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>interface</span> <span class=nc>Calculator</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 加
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>add</span><span class=o>(</span><span class=kt>int</span> <span class=n>a</span><span class=o>,</span> <span class=kt>int</span> <span class=n>b</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 减
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>subtract</span><span class=o>(</span><span class=kt>int</span> <span class=n>a</span><span class=o>,</span> <span class=kt>int</span> <span class=n>b</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div></div><ul><li>创建目标类实现接口</li></ul><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>CalculatorImpl</span> <span class=kd>implements</span> <span class=n>Calculator</span><span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>add</span><span class=o>(</span><span class=kt>int</span> <span class=n>a</span><span class=o>,</span> <span class=kt>int</span> <span class=n>b</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>a</span> <span class=o>+</span> <span class=n>b</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>subtract</span><span class=o>(</span><span class=kt>int</span> <span class=n>a</span><span class=o>,</span> <span class=kt>int</span> <span class=n>b</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>a</span> <span class=o>-</span> <span class=n>b</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div></div><ul><li>创建代理类实现接口</li></ul><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>CalculatorProxy</span> <span class=kd>implements</span> <span class=n>Calculator</span><span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>//内部维护一个目标对象引用
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>private</span> <span class=n>Calculator</span> <span class=n>target</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>//构造函数传入目标对象
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>public</span> <span class=nf>CalculatorProxy</span><span class=o>(</span><span class=n>Calculator</span> <span class=n>target</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>target</span> <span class=o>=</span> <span class=n>target</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>add</span><span class=o>(</span><span class=kt>int</span> <span class=n>a</span><span class=o>,</span> <span class=kt>int</span> <span class=n>b</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;add方法开始&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>result</span> <span class=o>=</span> <span class=n>target</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>a</span><span class=o>,</span> <span class=n>b</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;add方法结束&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>result</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>subtract</span><span class=o>(</span><span class=kt>int</span> <span class=n>a</span><span class=o>,</span> <span class=kt>int</span> <span class=n>b</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;sub方法开始&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>result</span> <span class=o>=</span> <span class=n>target</span><span class=o>.</span><span class=na>subtract</span><span class=o>(</span><span class=n>a</span><span class=o>,</span> <span class=n>b</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;sub方法结束&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>result</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div></div><p>使用代理类内创建实现类来实现静态代理</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Test</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>contextLoads</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Calculator</span> <span class=n>calculator</span> <span class=o>=</span> <span class=k>new</span> <span class=n>CalculatorProxy</span><span class=o>(</span><span class=k>new</span> <span class=n>CalculatorImpl</span><span class=o>());</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>add</span> <span class=o>=</span> <span class=n>calculator</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>2</span><span class=o>,</span> <span class=n>4</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>add</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>subtract</span> <span class=o>=</span> <span class=n>calculator</span><span class=o>.</span><span class=na>subtract</span><span class=o>(</span><span class=n>5</span><span class=o>,</span> <span class=n>7</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>subtract</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div></div><p>得到结果：</p><img src=https://cdn.jsdelivr.net/gh/ZDaneel/cloudimg@main/img/202207141344537.png alt="截屏2022-07-14 13.44.31" style=zoom:50%><p>核心问题如下：</p><ul><li>依然存在重复代码</li><li>只能接收指定好的目标类</li></ul><p>只是简单将直接修改的方法，转移到了代理类上（解耦过程）</p><p>改进思路：传入接口+增加的代码，自动返回代理对象</p><h4 id=4-动态代理><a href=#4-动态代理 class=anchor-link>#</a><a href=#contents:4-动态代理 class=headings>4. 动态代理</a></h4><p>需要有Class类的概念（反射部分）</p><p>不使用new，直接用反射获取类来创建</p><p>代理只有接口，那怎么才能有类？</p><p>最重要的是<strong>增强代码+目标对象</strong>，本质上代理对象只要有方法申明即可</p><p>通过<strong>目标类实现的接口</strong>来完成动态代理</p><p>测试接口和实现类的构造器和方法</p><ul><li><strong>接口Class对象没有构造方法</strong>，所以Calculator接口不能直接new对象</li><li>实现类Class对象有构造方法，所以CalculatorImpl实现类可以new对象</li><li>接口Class对象有两个方法add()、subtract()</li><li>实现类Class对象除了add()、subtract()，还有从Object继承的方法</li></ul><p>接口没有构造器，不能直接new，于是就将其中的<strong>方法</strong>给到另一个Class，再加上<strong>构造器</strong></p><p><strong>动态代理本质：用接口Class造出一个代理类Class</strong></p><p>Proxy.getProxyClass(类加载器，接口的Class对象)：返回代理类的Class对象</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Class</span><span class=o>&lt;?&gt;</span> <span class=n>proxyClass</span> <span class=o>=</span> <span class=n>Proxy</span><span class=o>.</span><span class=na>getProxyClass</span><span class=o>(</span><span class=n>Calculator</span><span class=o>.</span><span class=na>class</span><span class=o>.</span><span class=na>getClassLoader</span><span class=o>(),</span> <span class=n>Calculator</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=c1>//查看类型
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>CalculatorImpl</span><span class=o>.</span><span class=na>class</span><span class=o>.</span><span class=na>getName</span><span class=o>());</span>
</span></span><span class=line><span class=cl><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>proxyClass</span><span class=o>.</span><span class=na>getName</span><span class=o>());</span>
</span></span><span class=line><span class=cl><span class=c1>//打印代理Class对象的构造器和方法
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>Constructor</span><span class=o>&lt;?&gt;[]</span> <span class=n>constructors</span> <span class=o>=</span> <span class=n>proxyClass</span><span class=o>.</span><span class=na>getConstructors</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;构造器&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>printClassInfo</span><span class=o>(</span><span class=n>constructors</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;\n&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>Method</span><span class=o>[]</span> <span class=n>methods</span> <span class=o>=</span> <span class=n>proxyClass</span><span class=o>.</span><span class=na>getMethods</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;方法&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>printClassInfo</span><span class=o>(</span><span class=n>methods</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;\n&#34;</span><span class=o>);</span>
</span></span></code></pre></td></tr></table></div></div></div><p>注意：Proxy有两个包，一个是JDK自带的，一个是Spring框架里的</p><p>结果为</p><pre tabindex=0><code>cs2020.proxy_yuque.demo.CalculatorImpl
jdk.proxy2.$Proxy79
构造器
jdk.proxy2.$Proxy79(java.lang.reflect.InvocationHandler)


方法
add(int,int)
equals(java.lang.Object)
toString()
hashCode()
subtract(int,int)
newProxyInstance(java.lang.ClassLoader,[Ljava.lang.Class;,java.lang.reflect.InvocationHandler)
getProxyClass(java.lang.ClassLoader,[Ljava.lang.Class;)
getInvocationHandler(java.lang.Object)
isProxyClass(java.lang.Class)
wait(long,int)
wait()
wait(long)
getClass()
notify()
notifyAll()
</code></pre><p>接下去使用构造器来创建代理实现类</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Class</span><span class=o>&lt;?&gt;</span> <span class=n>calculatorProxyClass</span> <span class=o>=</span> <span class=n>Proxy</span><span class=o>.</span><span class=na>getProxyClass</span><span class=o>(</span><span class=n>Calculator</span><span class=o>.</span><span class=na>class</span><span class=o>.</span><span class=na>getClassLoader</span><span class=o>(),</span> <span class=n>Calculator</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=c1>//传入JDK自带的InvocationHandler.class
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>Constructor</span><span class=o>&lt;?&gt;</span> <span class=n>constructor</span> <span class=o>=</span> <span class=n>calculatorProxyClass</span><span class=o>.</span><span class=na>getConstructor</span><span class=o>(</span><span class=n>InvocationHandler</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>constructor</span><span class=o>);</span><span class=c1>//public jdk.proxy2.$Proxy79(java.lang.reflect.InvocationHandler)
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>//构造器执行构造方法，得到代理对象
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>Calculator</span> <span class=n>calculatorProxyImpl</span> <span class=o>=</span> <span class=o>(</span><span class=n>Calculator</span><span class=o>)</span> <span class=n>constructor</span><span class=o>.</span><span class=na>newInstance</span><span class=o>(</span><span class=k>new</span> <span class=n>InvocationHandler</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Object</span> <span class=nf>invoke</span><span class=o>(</span><span class=n>Object</span> <span class=n>proxy</span><span class=o>,</span> <span class=n>Method</span> <span class=n>method</span><span class=o>,</span> <span class=n>Object</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Throwable</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>10086</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>//获得了方法
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>calculatorProxyImpl</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>2</span><span class=o>,</span> <span class=n>4</span><span class=o>));</span>
</span></span></code></pre></td></tr></table></div></div></div><p>最终并没有和预期一样输出6，而是10086</p><p>原因：每次调用代理实现类的方法（calculatorProxyImpl.add(2, 4)），JVM就会将方法导向invoke，可以理解为中间多了一层invoke，中间指代理实现类和目标类的方法中间。</p><p>于是对invoke进行改进，最low的一种做法</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>//构造器执行构造方法，得到代理对象
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>Calculator</span> <span class=n>calculatorProxyImpl</span> <span class=o>=</span> <span class=o>(</span><span class=n>Calculator</span><span class=o>)</span> <span class=n>constructor</span><span class=o>.</span><span class=na>newInstance</span><span class=o>(</span><span class=k>new</span> <span class=n>InvocationHandler</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Object</span> <span class=nf>invoke</span><span class=o>(</span><span class=n>Object</span> <span class=n>proxy</span><span class=o>,</span> <span class=n>Method</span> <span class=n>method</span><span class=o>,</span> <span class=n>Object</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Throwable</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>CalculatorImpl</span> <span class=n>calculatorImpl</span> <span class=o>=</span> <span class=k>new</span> <span class=n>CalculatorImpl</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;方法开始执行&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Object</span> <span class=n>result</span> <span class=o>=</span> <span class=n>method</span><span class=o>.</span><span class=na>invoke</span><span class=o>(</span><span class=n>calculatorImpl</span><span class=o>,</span> <span class=n>args</span><span class=o>);</span><span class=c1>//传入目标对象和参数
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>result</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;方法执行结束&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>result</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>});</span>
</span></span></code></pre></td></tr></table></div></div></div><p>进行改进：</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@SneakyThrows</span>
</span></span><span class=line><span class=cl><span class=nd>@Test</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>ProxyTest4</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>CalculatorImpl</span> <span class=n>target</span> <span class=o>=</span> <span class=k>new</span> <span class=n>CalculatorImpl</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>Calculator</span> <span class=n>calculator</span> <span class=o>=</span> <span class=o>(</span><span class=n>Calculator</span><span class=o>)</span> <span class=n>getProxy</span><span class=o>(</span><span class=n>target</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>calculator</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>2</span><span class=o>,</span> <span class=n>4</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>calculator</span><span class=o>.</span><span class=na>subtract</span><span class=o>(</span><span class=n>4</span><span class=o>,</span> <span class=n>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * 传入目标对象，获取代理对象
</span></span></span><span class=line><span class=cl><span class=cm> * @param target 目标对象
</span></span></span><span class=line><span class=cl><span class=cm> * @return 代理对象
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=nd>@SneakyThrows</span>
</span></span><span class=line><span class=cl><span class=kd>private</span> <span class=kd>static</span> <span class=n>Object</span> <span class=nf>getProxy</span><span class=o>(</span><span class=n>Object</span> <span class=n>target</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Class</span><span class=o>&lt;?&gt;</span> <span class=n>proxyClass</span> <span class=o>=</span> <span class=n>Proxy</span><span class=o>.</span><span class=na>getProxyClass</span><span class=o>(</span><span class=n>target</span><span class=o>.</span><span class=na>getClass</span><span class=o>().</span><span class=na>getClassLoader</span><span class=o>(),</span> <span class=n>target</span><span class=o>.</span><span class=na>getClass</span><span class=o>().</span><span class=na>getInterfaces</span><span class=o>());</span>
</span></span><span class=line><span class=cl>    <span class=n>Constructor</span><span class=o>&lt;?&gt;</span> <span class=n>constructor</span> <span class=o>=</span> <span class=n>proxyClass</span><span class=o>.</span><span class=na>getConstructor</span><span class=o>(</span><span class=n>InvocationHandler</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>constructor</span><span class=o>.</span><span class=na>newInstance</span><span class=o>(</span><span class=k>new</span> <span class=n>InvocationHandler</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>Object</span> <span class=nf>invoke</span><span class=o>(</span><span class=n>Object</span> <span class=n>proxy</span><span class=o>,</span> <span class=n>Method</span> <span class=n>method</span><span class=o>,</span> <span class=n>Object</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Throwable</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;方法开始执行&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>Object</span> <span class=n>result</span> <span class=o>=</span> <span class=n>method</span><span class=o>.</span><span class=na>invoke</span><span class=o>(</span><span class=n>target</span><span class=o>,</span> <span class=n>args</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;运算结果为: &#34;</span> <span class=o>+</span> <span class=n>result</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;方法执行结束&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>result</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>});</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div></div><p>抽成一个方法后更加清晰易懂</p><p>之后还能进一步优化，抽取InvocationHandler，进一步解耦</p><p>JDK提供了Proxy.newProxyInstance()，参数为类加载器、接口数组、InvovationHandler</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Test</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>ProxyTest5</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>CalculatorImpl</span> <span class=n>target</span> <span class=o>=</span> <span class=k>new</span> <span class=n>CalculatorImpl</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>InvocationHandler</span> <span class=n>logInvocationHandler</span> <span class=o>=</span> <span class=n>getLogInvocationHandler</span><span class=o>(</span><span class=n>target</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>Calculator</span> <span class=n>calculator</span> <span class=o>=</span> <span class=o>(</span><span class=n>Calculator</span><span class=o>)</span> <span class=n>Proxy</span><span class=o>.</span><span class=na>newProxyInstance</span><span class=o>(</span>
</span></span><span class=line><span class=cl>            <span class=n>target</span><span class=o>.</span><span class=na>getClass</span><span class=o>().</span><span class=na>getClassLoader</span><span class=o>(),</span>
</span></span><span class=line><span class=cl>            <span class=n>target</span><span class=o>.</span><span class=na>getClass</span><span class=o>().</span><span class=na>getInterfaces</span><span class=o>(),</span>
</span></span><span class=line><span class=cl>            <span class=n>logInvocationHandler</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>calculator</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>2</span><span class=o>,</span> <span class=n>22</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * 日志增加代码
</span></span></span><span class=line><span class=cl><span class=cm> * @param target 目标对象
</span></span></span><span class=line><span class=cl><span class=cm> * @return InvocationHandler
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=kd>private</span> <span class=kd>static</span> <span class=n>InvocationHandler</span> <span class=nf>getLogInvocationHandler</span><span class=o>(</span><span class=kd>final</span> <span class=n>Calculator</span> <span class=n>target</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>new</span> <span class=n>InvocationHandler</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>Object</span> <span class=nf>invoke</span><span class=o>(</span><span class=n>Object</span> <span class=n>proxy</span><span class=o>,</span> <span class=n>Method</span> <span class=n>method</span><span class=o>,</span> <span class=n>Object</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Throwable</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;方法开始执行&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>Object</span> <span class=n>result</span> <span class=o>=</span> <span class=n>method</span><span class=o>.</span><span class=na>invoke</span><span class=o>(</span><span class=n>target</span><span class=o>,</span> <span class=n>args</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;运算结果为: &#34;</span> <span class=o>+</span> <span class=n>result</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;方法执行结束&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>result</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>};</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div></div><h3 id=基于子类的代理cglib><a href=#基于子类的代理cglib class=anchor-link>#</a><a href=#contents:基于子类的代理cglib class=headings>基于子类的代理（cglib）</a></h3><p>使用第三方jar包，cglib</p><p>使用方法和JDK版大同小异</p><p>报错需要在运行配置的VM option里添加--add-opens java.base/java.lang=ALL-UNNAMED</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>final</span> <span class=n>Producer</span> <span class=n>producer</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Producer</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>Producer</span> <span class=n>cglibProducer</span> <span class=o>=</span> <span class=o>(</span><span class=n>Producer</span><span class=o>)</span> <span class=n>Enhancer</span><span class=o>.</span><span class=na>create</span><span class=o>(</span><span class=n>producer</span><span class=o>.</span><span class=na>getClass</span><span class=o>(),</span> <span class=k>new</span> <span class=n>MethodInterceptor</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>         * 执行目标对象的方法就会经过该方法
</span></span></span><span class=line><span class=cl><span class=cm>         * @param o 代理对象本身
</span></span></span><span class=line><span class=cl><span class=cm>         * @param method 对象方法
</span></span></span><span class=line><span class=cl><span class=cm>         * @param objects 方法参数
</span></span></span><span class=line><span class=cl><span class=cm>         * @param methodProxy 当前执行方法的代理对象（一般用不上）
</span></span></span><span class=line><span class=cl><span class=cm>         * @return 方法执行
</span></span></span><span class=line><span class=cl><span class=cm>         * @throws Throwable 异常
</span></span></span><span class=line><span class=cl><span class=cm>         */</span>
</span></span><span class=line><span class=cl>        <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>Object</span> <span class=nf>intercept</span><span class=o>(</span><span class=n>Object</span> <span class=n>o</span><span class=o>,</span> <span class=n>Method</span> <span class=n>method</span><span class=o>,</span> <span class=n>Object</span><span class=o>[]</span> <span class=n>objects</span><span class=o>,</span> <span class=n>MethodProxy</span> <span class=n>methodProxy</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Throwable</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;我是代理哈哈哈&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>method</span><span class=o>.</span><span class=na>invoke</span><span class=o>(</span><span class=n>producer</span><span class=o>,</span> <span class=n>objects</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>});</span>
</span></span><span class=line><span class=cl>    <span class=n>cglibProducer</span><span class=o>.</span><span class=na>saleProduct</span><span class=o>(</span><span class=n>100</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div></div><h2 id=十aop><a href=#十aop class=anchor-link>#</a><a href=#contents:十aop class=headings>十、AOP</a></h2><h3 id=1-aop><a href=#1-aop class=anchor-link>#</a><a href=#contents:1-aop class=headings>1. AOP</a></h3><p>面向切面编程</p><ul><li>减少重复代码</li><li>维护方便</li><li>提高开发效率</li></ul><p>使用动态代理实现</p><h3 id=2-spring中的aop><a href=#2-spring中的aop class=anchor-link>#</a><a href=#contents:2-spring中的aop class=headings>2. Spring中的AOP</a></h3><p>配置分为注解和xml</p><p>术语：</p><ul><li><p>Joinpoint（连接点）：业务层接口里的方法，通过方法加上增强代码</p></li><li><p>Pointcut（切入点）：对哪些Joinpoint进行拦截，即选择部分方法加上增强代码</p></li><li><p>Advice（通知/增强）：拦截到Joinpoint后要做的事情</p></li></ul><p>通知类型：前置、后置、异常、最终、环绕</p><p>指的是在method.invoke()之前、之后、catch中、fianlly中，整个invoke方法执行就是环绕通知，在环绕通知中有明确的切入点方法通知</p><ul><li>Introduction（引介）：特殊通知，不修改类代码前提下，动态添加（目前无用）</li><li>Target（目标对象）：即要被代理的对象</li><li>Weaving（织入）：增强应用到目标对象来创建新的代理对象的过程</li><li>Proxy（代理）：织入处理后，结果代理类</li><li>Aspect（切面）：切入点和通知的结合，配置增强代码何时执行</li></ul><h4 id=xml文件头><a href=#xml文件头 class=anchor-link>#</a><a href=#contents:xml文件头 class=headings>XMl文件头</a></h4><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;beans</span> <span class=na>xmlns=</span><span class=s>&#34;http://www.springframework.org/schema/beans&#34;</span>
</span></span><span class=line><span class=cl>    <span class=na>xmlns:p=</span><span class=s>&#34;http://www.springframework.org/schema/p&#34;</span> <span class=na>xmlns:xsi=</span><span class=s>&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span class=line><span class=cl>    <span class=na>xmlns:context=</span><span class=s>&#34;http://www.springframework.org/schema/context&#34;</span>
</span></span><span class=line><span class=cl>    <span class=na>xmlns:aop=</span><span class=s>&#34;http://www.springframework.org/schema/aop&#34;</span>
</span></span><span class=line><span class=cl>    <span class=na>xsi:schemaLocation=</span><span class=s>&#34;http://www.springframework.org/schema/beans
</span></span></span><span class=line><span class=cl><span class=s>     http://www.springframework.org/schema/beans/spring-beans-4.1.xsd
</span></span></span><span class=line><span class=cl><span class=s>     http://www.springframework.org/schema/context
</span></span></span><span class=line><span class=cl><span class=s>     http://www.springframework.org/schema/context/spring-context-4.1.xsd
</span></span></span><span class=line><span class=cl><span class=s>     http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-4.1.xsd&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nt>&lt;/beans&gt;</span>
</span></span></code></pre></td></tr></table></div></div></div><p>具体配置</p><ol><li><p>通知的Bean交给Spring管理</p></li><li><p>aop:config标签表明开始AOP的配置</p></li><li><p>aop:aspect标签表明配置切面</p><ul><li><p>id：切面唯一标识</p></li><li><p>ref：指定通知类bean的id</p></li></ul></li><li><p>在aop:aspect内部使用对应的标签，指明使用的位置，即通知的类型</p><ul><li>method：用于指定切面里的哪个方法</li><li>pointcut：指定切入点，对业务层的哪些方法进行加强</li></ul></li></ol><img src=https://cdn.jsdelivr.net/gh/ZDaneel/cloudimg@main/img/202207151636919.png alt="截屏2022-07-15 16.35.58" style=zoom:50%><p>切入表达式写法：</p><ul><li><p>关键字：execution(表达式)</p></li><li><p>表达式：访问修饰符 返回值 包名…类名.方法名(参数列表)</p></li><li><p>写法案例：</p><pre tabindex=0><code>execution(public void cs2023.service.impl.AccountServiceImpl.saveAccount())
</code></pre></li><li><p>表达式简化</p><ul><li><p>访问修饰符可以省略</p><pre tabindex=0><code>void cs2023.service.impl.AccountServiceImpl.saveAccount()
</code></pre></li><li><p>返回值可以使用通配符表示任意</p><pre tabindex=0><code>* cs2023.service.impl.AccountServiceImpl.saveAccount()
</code></pre></li><li><p>包名可以使用通配符表示任意包，几级的包就写几个*</p><pre tabindex=0><code>* *.*.*.AccountServiceImpl.saveAccount()
</code></pre><p>或者再使用..表示当前包及其子包</p><pre tabindex=0><code>* *..AccountServiceImpl.saveAccount()
</code></pre></li><li><p>类名和方法名都使用*实现通配</p><pre tabindex=0><code>* *..*.*()
</code></pre><p>参数列表当前为空，只会匹配空参列表的函数</p></li><li><p>参数基本类型直接写名称，引用类型写包名.类名的方式 java.lang.String，使用*表示有参数</p><pre tabindex=0><code>* *..*.*(int)
</code></pre></li><li><p>..表示匹配任意的参数，全通配符：</p><pre tabindex=0><code>* *..*.*(..)
</code></pre></li></ul></li><li><p>项目通常的写法</p><p>切到业务层实现类下的所有方法</p><pre tabindex=0><code>* cs2023.service.impl.*.*(..)
</code></pre></li></ul><h3 id=3常用通知类型><a href=#3常用通知类型 class=anchor-link>#</a><a href=#contents:3常用通知类型 class=headings>3.常用通知类型</a></h3><ul><li>前置通知——before：切入点方法执行之前</li><li>后置通知——after-returning：切入点方法正常执行之后</li><li>异常通知——after-throwing：切入点方法执行产生异常之后</li><li>最终通知——after：无论切入点方法是否正常执行都会在后面执行</li></ul><h4 id=配置信息><a href=#配置信息 class=anchor-link>#</a><a href=#contents:配置信息 class=headings>配置信息</a></h4><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=c>&lt;!--前置通知--&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;aop:before</span> <span class=na>method=</span><span class=s>&#34;beforePrintLog&#34;</span> <span class=na>pointcut=</span><span class=s>&#34;execution(* cs2023.service.impl.*.*(..))&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl><span class=c>&lt;!--后置通知--&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;aop:after-returning</span> <span class=na>method=</span><span class=s>&#34;afterReturnPrintLog&#34;</span> <span class=na>pointcut=</span><span class=s>&#34;execution(* cs2023.service.impl.*.*(..))&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl><span class=c>&lt;!--异常通知--&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;aop:after-throwing</span> <span class=na>method=</span><span class=s>&#34;afterThrowPrintLog&#34;</span> <span class=na>pointcut=</span><span class=s>&#34;execution(* cs2023.service.impl.*.*(..))&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl><span class=c>&lt;!--最终通知--&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;aop:after</span> <span class=na>method=</span><span class=s>&#34;afterPrintLog&#34;</span> <span class=na>pointcut=</span><span class=s>&#34;execution(* cs2023.service.impl.*.*(..))&#34;</span><span class=nt>/&gt;</span>
</span></span></code></pre></td></tr></table></div></div></div><h4 id=正常运行><a href=#正常运行 class=anchor-link>#</a><a href=#contents:正常运行 class=headings>正常运行</a></h4><pre tabindex=0><code>========Logger类打印前置通知before========
执行了保存
========Logger类打印后置通知afterReturn========
========Logger类打印最终通知after========
</code></pre><h4 id=出现异常><a href=#出现异常 class=anchor-link>#</a><a href=#contents:出现异常 class=headings>出现异常</a></h4><pre tabindex=0><code>========Logger类打印前置通知before========
执行了保存
========Logger类打印异常通知afterThrowing========
========Logger类打印最终通知after========

java.lang.ArithmeticException: / by zero
</code></pre><h3 id=4-切入点表达式><a href=#4-切入点表达式 class=anchor-link>#</a><a href=#contents:4-切入点表达式 class=headings>4. 切入点表达式</a></h3><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=c>&lt;!--表达式切入点--&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;aop:pointcut</span> <span class=na>id=</span><span class=s>&#34;pc1&#34;</span> <span class=na>expression=</span><span class=s>&#34;execution(* cs2023.service.impl.*.*(..))&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl><span class=c>&lt;!--最终通知--&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;aop:after</span> <span class=na>method=</span><span class=s>&#34;afterPrintLog&#34;</span> <span class=na>pointcut-ref=</span><span class=s>&#34;pc1&#34;</span><span class=nt>/&gt;</span>
</span></span></code></pre></td></tr></table></div></div></div><p>如果写在aop:aspect外面，代表着所有切面可用；根据约束，必须在使用的aop:aspect之前</p><h3 id=5-环绕通知><a href=#5-环绕通知 class=anchor-link>#</a><a href=#contents:5-环绕通知 class=headings>5. 环绕通知</a></h3><p>配置之后，切入点方法没有执行，只有环绕方法执行</p><p>原因：动态代理的环绕通知有明确的切入点方法调用</p><p>解决：Spring提供了一个接口ProceedingJoinPoint，里面有个方法proceed()，相当于明确调用切入点方法</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=n>Object</span> <span class=nf>aroundPrintLog</span><span class=o>(</span><span class=n>ProceedingJoinPoint</span> <span class=n>proceedingJoinPoint</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Object</span> <span class=n>rtValue</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;========Logger类打印环绕前置========&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Object</span><span class=o>[]</span> <span class=n>args</span> <span class=o>=</span> <span class=n>proceedingJoinPoint</span><span class=o>.</span><span class=na>getArgs</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>rtValue</span> <span class=o>=</span> <span class=n>proceedingJoinPoint</span><span class=o>.</span><span class=na>proceed</span><span class=o>(</span><span class=n>args</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;========Logger类打印环绕后置========&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>Throwable</span> <span class=n>t</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;========Logger类打印环绕异常========&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=o>(</span><span class=n>t</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>finally</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;========Logger类打印环绕最终========&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>rtValue</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div></div><h3 id=6-基于注解的aop><a href=#6-基于注解的aop class=anchor-link>#</a><a href=#contents:6-基于注解的aop class=headings>6. 基于注解的AOP</a></h3><p>xml文件</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl>    <span class=c>&lt;!--配置spring创建容器要扫描的包--&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;context:component-scan</span> <span class=na>base-package=</span><span class=s>&#34;cs2023&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!--spring开启aop的注解--&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;aop:aspectj-autoproxy/&gt;</span>
</span></span></code></pre></td></tr></table></div></div></div><p>aop类</p><p>大致用法和xml配置相似</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * 记录日志的工具类
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=nd>@Component</span>
</span></span><span class=line><span class=cl><span class=nd>@Aspect</span><span class=c1>//表示为切面类
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Logger</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Pointcut</span><span class=o>(</span><span class=s>&#34;execution(* cs2023.service.impl.*.*(..))&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>pointcut</span><span class=o>(){}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 前置通知
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Before</span><span class=o>(</span><span class=s>&#34;pointcut()&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>beforePrintLog</span><span class=o>(){</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;========Logger类打印前置通知before========&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 后置通知
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=nd>@AfterReturning</span><span class=o>(</span><span class=s>&#34;pointcut()&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>afterReturnPrintLog</span><span class=o>(){</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;========Logger类打印后置通知afterReturn========&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 异常通知
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=nd>@AfterThrowing</span><span class=o>(</span><span class=s>&#34;pointcut()&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>afterThrowPrintLog</span><span class=o>(){</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;========Logger类打印异常通知afterThrowing========&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 最终通知
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=nd>@After</span><span class=o>(</span><span class=s>&#34;pointcut()&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>afterPrintLog</span><span class=o>(){</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;========Logger类打印最终通知after========&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div></div><p>存在问题，输出顺序有错误，所以建议使用环绕通知</p><pre tabindex=0><code>========Logger类打印前置通知before========
执行了保存
========Logger类打印最终通知after========
========Logger类打印后置通知afterReturn========
</code></pre><p>不使用xml的话，java配置类里面加一个注解@EnableAspectAutoProxy</p></div></article><div class=post-share><div class=share-text>分享：</div><div class=share-items><div class="share-item twitter"><a href="https://twitter.com/share?url=https://zdaneel.github.io/tech/spring%E7%AC%94%E8%AE%B0-%E9%BB%91%E9%A9%AC%E7%89%88/&text=Spring%e7%ac%94%e8%ae%b0-%e9%bb%91%e9%a9%ac%e7%89%88&hashtags=&via=ZDaneelZ" title=分享到「Twitter」 target=_blank rel=noopener><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon twitter-icon"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645.0 138.72-105.583 298.558-298.558 298.558-59.452.0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055.0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421.0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391.0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04.0-57.828 46.782-104.934 104.934-104.934 30.213.0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg></a></div><div class="share-item facebook"><a href="https://www.facebook.com/sharer/sharer.php?u=https://zdaneel.github.io/tech/spring%E7%AC%94%E8%AE%B0-%E9%BB%91%E9%A9%AC%E7%89%88/&hashtag=%23" title=分享到「Facebook」 target=_blank rel=noopener><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon facebook-icon"><path d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14.0 55.52 4.84 55.52 4.84v61h-31.28c-30.8.0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg></a></div><div class="share-item linkedin"><a href="https://www.linkedin.com/shareArticle?mini=true&url=https://zdaneel.github.io/tech/spring%E7%AC%94%E8%AE%B0-%E9%BB%91%E9%A9%AC%E7%89%88/&title=Spring%e7%ac%94%e8%ae%b0-%e9%bb%91%e9%a9%ac%e7%89%88&summary=%e8%a1%a5%e5%85%85%e4%ba%86%e9%bb%91%e9%a9%ac%e8%a7%86%e9%a2%91%e7%89%88%e6%9c%ac%e7%9a%84%e7%ac%94%e8%ae%b0%ef%bc%8c%e9%bb%91%e9%a9%ac%e7%89%88%e7%9b%b8%e6%af%94%e4%b9%8b%e4%b8%8b%e6%9b%b4%e5%8a%a0%e6%b7%b1%e5%85%a5%ef%bc%8c%e5%af%b9%e5%8e%9f%e7%90%86%e7%9a%84%e8%ae%b2%e8%a7%a3%e4%b9%9f%e8%a6%81%e6%b8%85%e6%99%b0%e5%be%88%e5%a4%9a%e3%80%82%20%e4%b8%80%e3%80%81%e6%a6%82%e8%bf%b0%e2%80%a6%e2%80%a6%0a%20%20%20%20%0a%20%20%20%20&source=leenadz" title=分享到「LinkedIn」 target=_blank rel=noopener><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon linkedin-icon"><path d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg></a></div><div class="share-item telegram"><a href="https://t.me/share/url?url=https://zdaneel.github.io/tech/spring%E7%AC%94%E8%AE%B0-%E9%BB%91%E9%A9%AC%E7%89%88/&text=Spring%e7%ac%94%e8%ae%b0-%e9%bb%91%e9%a9%ac%e7%89%88" title=分享到「Telegram」 target=_blank rel=noopener><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" class="icon telegram-icon"><path d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm121.8 169.9-40.7 191.8c-3 13.6-11.1 16.9-22.4 10.5l-62-45.7-29.9 28.8c-3.3 3.3-6.1 6.1-12.5 6.1l4.4-63.1 114.9-103.8c5-4.4-1.1-6.9-7.7-2.5l-142 89.4-61.2-19.1c-13.3-4.2-13.6-13.3 2.8-19.7l239.1-92.2c11.1-4 20.8 2.7 17.2 19.5z"/></svg></a></div><div class="share-item weibo"><a href="https://service.weibo.com/share/share.php?&url=https://zdaneel.github.io/tech/spring%E7%AC%94%E8%AE%B0-%E9%BB%91%E9%A9%AC%E7%89%88/&title=Spring%e7%ac%94%e8%ae%b0-%e9%bb%91%e9%a9%ac%e7%89%88&pic=https://cdn.jsdelivr.net/gh/ZDaneel/cloudimg@main/img/202207111601133.png&searchPic=false" title=分享到「新浪微博」 target=_blank rel=noopener><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon weibo-icon"><path d="M407 177.6c7.6-24-13.4-46.8-37.4-41.7-22 4.8-28.8-28.1-7.1-32.8 50.1-10.9 92.3 37.1 76.5 84.8-6.8 21.2-38.8 10.8-32-10.3zM214.8 446.7C108.5 446.7.0 395.3.0 310.4c0-44.3 28-95.4 76.3-143.7C176 67 279.5 65.8 249.9 161c-4 13.1 12.3 5.7 12.3 6 79.5-33.6 140.5-16.8 114 51.4-3.7 9.4 1.1 10.9 8.3 13.1 135.7 42.3 34.8 215.2-169.7 215.2zm143.7-146.3c-5.4-55.7-78.5-94-163.4-85.7-84.8 8.6-148.8 60.3-143.4 116s78.5 94 163.4 85.7c84.8-8.6 148.8-60.3 143.4-116zM347.9 35.1c-25.9 5.6-16.8 43.7 8.3 38.3 72.3-15.2 134.8 52.8 111.7 124-7.4 24.2 29.1 37 37.4 12 31.9-99.8-55.1-195.9-157.4-174.3zm-78.5 311c-17.1 38.8-66.8 60-109.1 46.3-40.8-13.1-58-53.4-40.3-89.7 17.7-35.4 63.1-55.4 103.4-45.1 42 10.8 63.1 50.2 46 88.5zm-86.3-30c-12.9-5.4-30 .3-38 12.9-8.3 12.9-4.3 28 8.6 34 13.1 6 30.8.3 39.1-12.9 8-13.1 3.7-28.3-9.7-34zm32.6-13.4c-5.1-1.7-11.4.6-14.3 5.4-2.9 5.1-1.4 10.6 3.7 12.9 5.1 2 11.7-.3 14.6-5.4 2.8-5.2 1.1-10.9-4-12.9z"/></svg></a></div><div class="share-item douban"><a href="https://www.douban.com/share/service?href=https://zdaneel.github.io/tech/spring%E7%AC%94%E8%AE%B0-%E9%BB%91%E9%A9%AC%E7%89%88/&name=Spring%e7%ac%94%e8%ae%b0-%e9%bb%91%e9%a9%ac%e7%89%88&text=%e8%a1%a5%e5%85%85%e4%ba%86%e9%bb%91%e9%a9%ac%e8%a7%86%e9%a2%91%e7%89%88%e6%9c%ac%e7%9a%84%e7%ac%94%e8%ae%b0%ef%bc%8c%e9%bb%91%e9%a9%ac%e7%89%88%e7%9b%b8%e6%af%94%e4%b9%8b%e4%b8%8b%e6%9b%b4%e5%8a%a0%e6%b7%b1%e5%85%a5%ef%bc%8c%e5%af%b9%e5%8e%9f%e7%90%86%e7%9a%84%e8%ae%b2%e8%a7%a3%e4%b9%9f%e8%a6%81%e6%b8%85%e6%99%b0%e5%be%88%e5%a4%9a%e3%80%82%20%e4%b8%80%e3%80%81%e6%a6%82%e8%bf%b0%e2%80%a6%e2%80%a6%0a%20%20%20%20%0a%20%20%20%20" title=分享到「豆瓣」 target=_blank rel=noopener><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="icon douban-icon"><path d="M.643.92v2.412h22.714V.92H.643zm1.974 4.926v9.42h18.764v-9.42H2.617zm2.72 2.408H18.69v4.605H5.338V8.254zm1.657 7.412-2.512.938c1.037 1.461 1.87 2.825 2.512 4.091H0v2.385h24v-2.385h-6.678c.818-1.176 1.589-2.543 2.303-4.091l-2.73-.938a29.952 29.952.0 01-2.479 5.03h-4.75c-.786-1.962-1.677-3.641-2.672-5.03z"/></svg></a></div><div class="share-item qq"><a href="https://connect.qq.com/widget/shareqq/index.html?url=https://zdaneel.github.io/tech/spring%E7%AC%94%E8%AE%B0-%E9%BB%91%E9%A9%AC%E7%89%88/&title=Spring%e7%ac%94%e8%ae%b0-%e9%bb%91%e9%a9%ac%e7%89%88&summary=%e8%a1%a5%e5%85%85%e4%ba%86%e9%bb%91%e9%a9%ac%e8%a7%86%e9%a2%91%e7%89%88%e6%9c%ac%e7%9a%84%e7%ac%94%e8%ae%b0%ef%bc%8c%e9%bb%91%e9%a9%ac%e7%89%88%e7%9b%b8%e6%af%94%e4%b9%8b%e4%b8%8b%e6%9b%b4%e5%8a%a0%e6%b7%b1%e5%85%a5%ef%bc%8c%e5%af%b9%e5%8e%9f%e7%90%86%e7%9a%84%e8%ae%b2%e8%a7%a3%e4%b9%9f%e8%a6%81%e6%b8%85%e6%99%b0%e5%be%88%e5%a4%9a%e3%80%82%20%e4%b8%80%e3%80%81%e6%a6%82%e8%bf%b0%e2%80%a6%e2%80%a6%0a%20%20%20%20%0a%20%20%20%20&pics=https://cdn.jsdelivr.net/gh/ZDaneel/cloudimg@main/img/202207111601133.png&site=leenadz" title=分享到「QQ」 target=_blank rel=noopener><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon qq-icon"><path d="M433.754 420.445c-11.526 1.393-44.86-52.741-44.86-52.741.0 31.345-16.136 72.247-51.051 101.786 16.842 5.192 54.843 19.167 45.803 34.421-7.316 12.343-125.51 7.881-159.632 4.037-34.122 3.844-152.316 8.306-159.632-4.037-9.045-15.25 28.918-29.214 45.783-34.415-34.92-29.539-51.059-70.445-51.059-101.792.0.0-33.334 54.134-44.859 52.741-5.37-.65-12.424-29.644 9.347-99.704 10.261-33.024 21.995-60.478 40.144-105.779C60.683 98.063 108.982.006 224 0c113.737.006 163.156 96.133 160.264 214.963 18.118 45.223 29.912 72.85 40.144 105.778 21.768 70.06 14.716 99.053 9.346 99.704z"/></svg></a></div><div class="share-item qzone"><a href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://zdaneel.github.io/tech/spring%E7%AC%94%E8%AE%B0-%E9%BB%91%E9%A9%AC%E7%89%88/&title=Spring%e7%ac%94%e8%ae%b0-%e9%bb%91%e9%a9%ac%e7%89%88&summary=%e8%a1%a5%e5%85%85%e4%ba%86%e9%bb%91%e9%a9%ac%e8%a7%86%e9%a2%91%e7%89%88%e6%9c%ac%e7%9a%84%e7%ac%94%e8%ae%b0%ef%bc%8c%e9%bb%91%e9%a9%ac%e7%89%88%e7%9b%b8%e6%af%94%e4%b9%8b%e4%b8%8b%e6%9b%b4%e5%8a%a0%e6%b7%b1%e5%85%a5%ef%bc%8c%e5%af%b9%e5%8e%9f%e7%90%86%e7%9a%84%e8%ae%b2%e8%a7%a3%e4%b9%9f%e8%a6%81%e6%b8%85%e6%99%b0%e5%be%88%e5%a4%9a%e3%80%82%20%e4%b8%80%e3%80%81%e6%a6%82%e8%bf%b0%e2%80%a6%e2%80%a6%0a%20%20%20%20%0a%20%20%20%20&pics=https://cdn.jsdelivr.net/gh/ZDaneel/cloudimg@main/img/202207111601133.png&site=leenadz" title="分享到「QQ 空间」" target=_blank rel=noopener><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="icon qzone-icon"><path d="M23.985 9.202c-.032-.099-.127-.223-.334-.258-.207-.036-7.351-1.406-7.351-1.406s-.105-.022-.198-.07c-.092-.047-.127-.167-.127-.167S12.447.956 12.349.77C12.25.583 12.104.532 12 .532s-.251.051-.349.238c-.098.186-3.626 6.531-3.626 6.531s-.035.12-.128.167c-.092.047-.197.07-.197.07S.556 8.908.348 8.943c-.208.036-.302.16-.333.258a.477.477.0 00.125.449l5.362 5.49s.072.08.119.172c.016.104.005.21.005.21s-1.189 7.242-1.22 7.45.075.369.159.43c.083.062.233.106.421.013.189-.093 6.812-3.261 6.812-3.261s.098-.044.201-.061.201.061.201.061 6.623 3.168 6.812 3.261c.188.094.338.049.421-.013a.463.463.0 00.159-.43c-.021-.14-.93-5.677-.93-5.677.876-.54 1.425-1.039 1.849-1.747-2.594.969-6.006 1.717-9.415 1.866-.915.041-2.41.097-3.473-.015-.678-.071-1.17-.144-1.243-.438-.053-.215.054-.46.545-.831a2640.5 2640.5.0 012.861-2.155c1.285-.968 3.559-2.47 3.559-2.731.0-.285-2.144-.781-4.037-.781-1.945.0-2.275.132-2.811.168-.488.034-.769.005-.804-.138-.06-.248.183-.389.588-.568.709-.314 1.86-.594 1.984-.626.194-.052 3.082-.805 5.618-.535 1.318.14 3.244.668 3.244 1.276.0.342-1.721 1.494-3.225 2.597-1.149.843-2.217 1.561-2.217 1.688.0.342 3.533 1.241 6.689 1.01l.003-.022c.048-.092.119-.172.119-.172l5.362-5.49a.477.477.0 00.127-.449z"/></svg></a></div><div class="share-item qrcode"><div class=qrcode-container title=通过「二维码」><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon qrcode-icon"><path d="M0 224h192V32H0v192zM64 96h64v64H64V96zm192-64v192h192V32H256zm128 128h-64V96h64v64zM0 480h192V288H0v192zm64-128h64v64H64v-64zm352-64h32v128h-96v-32h-32v96h-64V288h96v32h64v-32zm0 160h32v32h-32v-32zm-64 0h32v32h-32v-32z"/></svg><div id=qrcode-img></div></div><script src=https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.4/qrcode.min.js></script>
<script>var typeNumber=0,errorCorrectionLevel="L",qr=qrcode(typeNumber,errorCorrectionLevel);qr.addData("https://zdaneel.github.io/tech/spring%E7%AC%94%E8%AE%B0-%E9%BB%91%E9%A9%AC%E7%89%88/"),qr.make(),document.getElementById("qrcode-img").innerHTML=qr.createImgTag()</script></div></div></div><ul class=post-nav><li class=post-nav-prev><a href=/tech/logisim%E5%9F%BA%E7%A1%80/ rel=prev>&lt; 同步时序电路分析</a></li><li class=post-nav-next><a href=/tech/spring%E7%AC%94%E8%AE%B0-%E7%8B%82%E7%A5%9E%E7%89%88/ rel=next>Spring笔记-狂神版 ></a></li></ul></div></main><div id=back-to-top class=back-to-top><a href=#><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon arrow-up"><path d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6.0-33.9L207 39c9.4-9.4 24.6-9.4 33.9.0l194.3 194.3c9.4 9.4 9.4 24.6.0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3.0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"/></svg></a></div><footer id=footer class=footer><div class=footer-inner><div class=site-info>©&nbsp;2021–2022&nbsp;<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon footer-icon"><path d="M462.3 62.6C407.5 15.9 326 24.3 275.7 76.2L256 96.5l-19.7-20.3C186.1 24.3 104.5 15.9 49.7 62.6c-62.8 53.6-66.1 149.8-9.9 207.9l193.5 199.8c12.5 12.9 32.8 12.9 45.3.0l193.5-199.8c56.3-58.1 53-154.3-9.8-207.9z"/></svg>&nbsp;zdaneel</div><div class=powered-by>Powered by <a href=https://github.com/gohugoio/hugo target=_blank rel=noopener>Hugo</a> | Theme is <a href=https://github.com/reuixiy/hugo-theme-meme target=_blank rel=noopener>MemE</a></div><span id=busuanzi_container_site_pv>本站访问量：<span id=busuanzi_value_site_pv></span>次</span>
&nbsp;
<span id=busuanzi_container_site_uv>您是本站第 <span id=busuanzi_value_site_uv></span> 位访问者</span></div></footer></div><script src=https://cdn.jsdelivr.net/gh/cferdinandi/smooth-scroll/dist/smooth-scroll.polyfills.min.js></script>
<script>var scroll=new SmoothScroll('a[href*="#"]',{speedAsDuration:!0,header:"[data-scroll-header]"})</script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.11.0/dist/katex.min.css integrity=sha384-BdGj8xC2eZkQaxoQ8nSLefg4AV4/AwB3Fj+8SUSo7pnKP6Eoy18liIKTPn9oBYNG crossorigin=anonymous><script>if(typeof renderMathInElement=="undefined"){var getScript=e=>{var t=document.createElement("script");t.defer=!0,t.crossOrigin="anonymous",Object.keys(e).forEach(n=>{t[n]=e[n]}),document.body.appendChild(t)};getScript({src:"https://cdn.jsdelivr.net/npm/katex@0.11.0/dist/katex.min.js",integrity:"sha384-JiKN5O8x9Hhs/UE5cT5AAJqieYlOZbGT3CHws/y97o3ty4R7/O5poG9F3JoiOYw1",onload:()=>{getScript({src:"https://cdn.jsdelivr.net/npm/katex@0.11.0/dist/contrib/mhchem.min.js",integrity:"sha384-oa0lfxCGjaU1LdYckhq8LZcP+JTf8cyJXe69O6VE6UrShzWveT6KiCElJrck/stm",onload:()=>{getScript({src:"https://cdn.jsdelivr.net/npm/katex@0.11.0/dist/contrib/auto-render.min.js",integrity:"sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI",onload:()=>{renderKaTex()}})}})}})}else renderKaTex();function renderKaTex(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"\\[",right:"\\]",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1}]})}</script><script src=https://cdn.jsdelivr.net/npm/medium-zoom@latest/dist/medium-zoom.min.js></script>
<script>mediumZoom(document.querySelectorAll("div.post-body img"),{background:"hsla(var(--color-bg-h), var(--color-bg-s), var(--color-bg-l), 0.95)"})</script><script src=https://cdn.jsdelivr.net/npm/instant.page@3.0.0/instantpage.min.js type=module defer></script></body></html>